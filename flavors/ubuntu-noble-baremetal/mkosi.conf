# Reference: https://github.com/systemd/mkosi/blob/main/mkosi/resources/mkosi.md

[Distribution]
Distribution=ubuntu
Release=noble
Repositories=main,restricted,universe,multiverse

[Output]
Format=disk
RepartDirectories=repart.grub
ManifestFormat=json

[Content]
Bootable=yes
Bootloader=grub
UnifiedKernelImages=no
Hostname=noblebaremetal
# For Hyper-V: linux-cloud-tools-generic
Packages=sudo,git,nano,file,zstd,jq,pv,less,neofetch,dnsutils,curl,tree,wget,sysstat,bash,fwupd,bash-completion,btop,htop,zsh,screen,tmux,hwdata,linux-image-generic,linux-firmware,amd64-microcode,intel-microcode,grub-efi,grub-common,os-prober,linux-tools-generic,udisks2,upower,systemd-resolved,systemd-sysv,chrony,systemd-sysv,openssh-server,openssh-client,ssh-import-id,python3-launchpadlib,apt-utils,ca-certificates,colorized-logs,command-not-found,console-setup,efibootmgr,iproute2,lvm2,network-manager,modemmanager,nfs-common,pciutils,usbutils,dialog,whiptail,rfkill,wpasupplicant,inetutils-ping,inetutils-traceroute,inetutils-telnet,netcat-traditional,vim,locales,tpm-udev,sg3-utils-udev,dmidecode,lm-sensors,picocom,iptables,linux-modules-nvidia-535-server-generic,nvidia-utils-535-server
WithNetwork=yes           # let mkosi.postinst access the internet
RootPassword=rootrootroot # The default root password
Autologin=true            # Autologin as root on consoles
# https://docs.kernel.org/admin-guide/serial-console.html
KernelCommandLine=rw intel_iommu=on loglevel=7 console=ttyS0,115200 console=tty0 console=ttyUSB0,115200

Locale=en_US.UTF-8
LocaleMessages=en_US.UTF-8
Timezone=Europe/Amsterdam

# Trick: exclude all, include all == get _all_ modules in the initrd
KernelModulesInitrdExclude=.*
KernelModulesInitrdInclude=.*

